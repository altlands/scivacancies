@using System.Threading.Tasks
@using System.Linq
@using SciVacancies.WebApp.Queries
@using SciVacancies.WebApp.ViewModels
@model IndexViewModel

@{
    var regions = Model.CurrentMediator.Send(new SelectAllRegionsQuery()).Select(c => new SelectListItem { Text = c.title, Value = c.id.ToString() }).ToList();
    regions.Insert(0, new SelectListItem { Text = "Все регионы", Value = "null" });
    ViewBag.RegionsList = regions;

    var dayPeriod = (int)Nest.DateInterval.Day;
    var weekPeriod = (int)Nest.DateInterval.Week;
    var monthPeriod = (int)Nest.DateInterval.Month;
}

<h4>Вакансии в графиках</h4>

<ul class="tabs tabs_after_title" id="graphicPeriod" onclick="refreshAllGraphicData();">
    <li class="active" data-pariod-value="@dayPeriod">
        <span>День</span>
    </li>
    <li data-pariod-value="@weekPeriod">
        <span>Неделя</span>
    </li>
    <li data-pariod-value="@monthPeriod">
        <span>Месяц</span>
    </li>
</ul>

<div class="graphics">


    <div class="graphics-item">
        <div class="title-graphic">Число вакансий ( среднее предложение )</div>

        <div id="chartContainer" style="height: 450px; width: 413px;">
        </div>

    </div>

    <div class="graphics-item">
        <div class="title-graphic">Средняя зарплата и количество вакансий</div>

        <div id="chartContainer2" style="min-height: 250px; width: 413px;">
        </div>

        <div class="graph-region-select-block">
            <select asp-for="RegionId"
                    asp-items="ViewBag.RegionsList"
                    onchange="refreshAllGraphicData()"></select>
        </div>


        <script type="text/javascript">
            window.onload = function () {

                graphs = graphs || {}; //глобальная переменная для графиков

                CanvasJS.addColorSet("blueShades4",
                [
                    //colorSet Array
                    "#041833",
                    "#06365c",
                    "#3a5e90",
                    "#d8e1e9"
                ]);
                CanvasJS.addColorSet("blueShades2",
                [
                    //colorSet Array
                    "#041833",
                    //"#06365c",
                    "#3a5e90"
                    //"#d8e1e9"
                ]);


                graphs.chart = new CanvasJS.Chart("chartContainer",
                {
                    colorSet: "blueShades4",

                    dataPointMaxWidth: 35,
                    title: {
                        //text: "Число вакансий ( среднее предложение в месяц )"
                    
                    },
                    axisX: {
                        titleFontSize: "12",
                        titleFontColor: "#3a5e90 ",
                        titleFontFamily: "Arial",

                        labelFontSize: "12",
                        labelFontColor: "#3a5e90 ",
                        labelFontFamily: "Arial",

                        lineThickness: 1,
                        tickLength: 0,
                        labelMaxWidth: 50
                    },
                    axisY: {
                        titleFontSize: "12",
                        titleFontColor: "#3a5e90 ",
                        titleFontFamily: "Arial",

                        labelFontSize: "12",
                        labelFontColor: "#3a5e90 ",
                        labelFontFamily: "Arial",

                        //title: "Вакансии"
                        lineThickness: 1,
                        tickLength: 0,
                        gridThickness: 1
                    },
                    animationEnabled: true,


                    toolTip: {
                        //shared: true,
                        content: function(e) {
                            var body;
                            var head;
                            var name = e.entries[0].dataSeries.name.length <= 25 ? e.entries[0].dataSeries.name : (e.entries[0].dataSeries.name.substring(0, 24) + "...");
                            head = "<span style = 'color:DodgerBlue; '><strong>Дата: " + (e.entries[0].dataPoint.label) + "</strong></span><br/>";
                            body = "<span style='\"'color: {color};'\"'><strong>"
                                + name
                                + "</strong></span>: "
                                + e.entries[0].dataPoint.y
                                + " вак.";
                            return (head.concat(body));
                        }
                    },


                    data: [
                        {
                            type: "stackedColumn",
                            //toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                            name: "Руководители групп структурных подразделений",
                            showInLegend: "true",
                            dataPoints: [
                                { y: 38600, label: "Июль" },
                                { y: 11338, label: "Август" },
                                { y: 49088, label: "Сентябрь" },
                                { y: 62200, label: "Октябрь" },
                                { y: 90085, label: "Ноябрь" }
                            ]
                        }, {
                            type: "stackedColumn",
                            //toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                            name: "Руководители структурных подразделений",
                            showInLegend: "true",
                            dataPoints: [
                                { y: 39900, label: "Июль" },
                                { y: 135305, label: "Август" },
                                { y: 107922, label: "Сентябрь" },
                                { y: 52300, label: "Октябрь" },
                                { y: 3360, label: "Ноябрь" }
                            ]
                        }, {
                            type: "stackedColumn",
                            //toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                            name: "Сотрудники",
                            showInLegend: "true",
                            dataPoints: [
                                { y: 39900, label: "Июль" },
                                { y: 135305, label: "Август" },
                                { y: 107922, label: "Сентябрь" },
                                { y: 52300, label: "Октябрь" },
                                { y: 3360, label: "Ноябрь" }
                            ]
                        }, {
                            type: "stackedColumn",
                            //toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                            name: "Прочие",
                            showInLegend: "true",
                            dataPoints: [
                                { y: 39900, label: "Июль" },
                                { y: 135305, label: "Август" },
                                { y: 107922, label: "Сентябрь" },
                                { y: 52300, label: "Октябрь" },
                                { y: 3360, label: "Ноябрь" }
                            ]
                        }
                    ],
                    legend: {
                        cursor: "pointer",

                        fontSize: 12,
                        fontFamily: "tahoma",
                        maxWidth: 400,

                        itemclick: function (e) {
                            if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                                e.dataSeries.visible = false;
                            } else {
                                e.dataSeries.visible = true;
                            }
                            graphs.chart.render();
                        }
                    }
                });


                graphs.chart2 = new CanvasJS.Chart("chartContainer2",
                {
                    colorSet: "blueShades2",

                    title: {
                        //text: "Средняя зарплата и количество вакансий"

                    },
                    animationEnabled: true,
                    toolTip: {
                        shared: true,
                        content: function (e) {
                            var body;
                            var head;
                            head = "<span style = 'color:DodgerBlue; '><strong>Дата: " + (e.entries[0].dataPoint.label) + "</strong></span><br/>";
                            body = "<span style= 'color:" + e.entries[0].dataSeries.color + "'> "
                                + (e.entries[0].dataSeries.name)
                                + "</span>: <strong>" + e.entries[0].dataPoint.y + "</strong>  тыс.р.<br/> <span style= 'color:" + e.entries[1].dataSeries.color + "'> " + e.entries[1].dataSeries.name + "</span>: <strong>" + e.entries[1].dataPoint.y + "</strong>  шт";

                            return (head.concat(body));
                        }
                    },
                    axisY: {
                        titleFontSize: "12",
                        titleFontColor: "#041833 ",
                        titleFontFamily: "Arial",
                        title: "Средняя з/п. (тыс.р.)",

                        labelFontSize: "12",
                        labelFontColor: "#3a5e90 ",
                        labelFontFamily: "Arial",

                        includeZero: false,
                        suffix: "",
                        lineColor: "#041833",
                        lineThickness: 1,
                        tickLength: 0,
                        gridThickness: 1
                    },
                    axisY2: {
                        titleFontSize: "12",
                        titleFontColor: "#3a5e90 ",
                        titleFontFamily: "Arial",
                        title: "Количество (шт.)",
                        includeZero: false,
                        suffix: "",
                        lineColor: "#3a5e90",
                        lineThickness: 1,
                        tickLength: 0,
                        gridThickness: 1
                    },
                    axisX: {
                        titleFontSize: "12",
                        titleFontColor: "#3a5e90 ",
                        titleFontFamily: "Arial",

                        labelFontSize: "12",
                        labelFontColor: "#3a5e90 ",
                        labelFontFamily: "Arial",

                        //title: "Месяцы",
                        //suffix: " мес",
                        lineThickness: 1,
                        tickLength: 0,
                        gridThickness: 1,
                        labelMaxWidth: 50
                    },
                    data: [
                        //{
                        //    legendMarkerColor: "#041833",
                        //    legendMarkerBorderThickness: "3",
                        //    legendMarkerBorderColor: "#041833",
                        //    type: "line",
                        //    legendText: "Средняя зп",
                        //    name: "Средняя зп",
                        //    showInLegend: true,
                        //    dataPoints: [
                        //    { x: 6, y: 0, label: "Июнь" },
                        //    { x: 7, y: 8.2, label: "Июль" },
                        //    { x: 8, y: 41.7, label: "Август" },
                        //    { x: 9, y: 16.7, label: "Сентябрь" },
                        //    { x: 10, y: 31.3, label: "Октябрь" }
                        //    ]
                        //},
                        //{
                        //    legendMarkerColor: "#3a5e90",
                        //    legendMarkerBorderThickness: "3",
                        //    legendMarkerBorderColor: "#3a5e90",
                        //    type: "line",
                        //    axisYType: "secondary",
                        //    name: "Вакансий",
                        //    legendText: "Вакансий",
                        //    showInLegend: true,
                        //    dataPoints: [
                        //    { x: 6, y: 0, label: "Июнь" },
                        //    { x: 7, y: 90, label: "Июль" },
                        //    { x: 8, y: 1590, label: "Август" },
                        //    { x: 9, y: 1740, label: "Сентябрь" },
                        //    { x: 10, y: 3740, label: "Октябрь" }
                        //    ]
                        //}
                    ],
                    legend: {
                        cursor: "pointer",

                        fontFamily: "Arial",
                        fontSize: 12,
                        color: "#041833",

                        maxWidth: 400,
                        itemclick: function (e) {
                            if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                                e.dataSeries.visible = false;
                            } else {
                                e.dataSeries.visible = true;
                            }
                            graphs.chart2.render();
                        }
                    }
                });


                //graphs.chart.render();
                //graphs.chart2.render();
                refreshAllGraphicData();
            }
        </script>



    </div>
</div>