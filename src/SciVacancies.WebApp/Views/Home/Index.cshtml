@using System.Threading.Tasks
@model SciVacancies.WebApp.ViewModels.IndexViewModel

<!--<div class="crumbs">
    @ViewBag.Title
    @Context.User.Identity.Name
</div>-->

<div class="row-block">
    <div class="row-2">

        <div class="align-right f0">
            <ul class="tabs-toggle inline-block">
                <li class="tabs-toggle__item active">
                    <a href="#vac-day" data-toggle="tab" class="vac-day tab_icon"></a>
                </li>
                <li class="tabs-toggle__item">
                    <a href="#work-org" data-toggle="tab" class="work-org tab_icon"></a>
                </li>
                <li class="tabs-toggle__item">
                    <a href="#vac-sci" data-toggle="tab" class="vac-sci tab_icon"></a>
                </li>
            </ul>
        </div>

        <div class="tab-content">
            <div class="tab-pane active" id="vac-day">
                <h4>Вакансии дня @ViewBag.test</h4>
                <div class="b-items">

                    @if (Model.VacanciesList != null)
                    {
                        foreach (var item in Model.VacanciesList.Items)
                        {
                            <text>
                            <a asp-controller="vacancies" asp-action="card" asp-route-id="@item.Guid" class="b-item bg_blue">
                                <div class="b-item__title top_title bg_lblue">
                                    <div class="line_three">@item.Name.Substring(0, Math.Min(item.Name.Length, 50))@(item.Name.Length > 50 ? "..." : null)</div>
                                </div>
                                <div class="b-item__content vac_item">
                                    <div class="cell-middle">
                                        <div class="b-vacan__price">@item.SalaryFrom – @item.SalaryTo руб.</div>
                                        <span class="b-vacan__desc">@item.OrganizationName</span>
                                    </div>
                                    <div class="helper"></div>
                                </div>
                            </a>
                            </text>
                        }
                    }
                </div>
                <a asp-controller="search" asp-route-order="">
                    <span class="small-icon icon-sm-eye inline-block ml6"><span>Показать все</span></span>
                </a>
            </div>
            <div class="tab-pane" id="work-org">
                <h4>Работа в организациях</h4>
                <div class="b-items">
                    @if (Model.OrganizationsList != null)
                    {
                        foreach (var item in Model.OrganizationsList.Items)
                        {
                            <text>
                            <a asp-controller="organizations" asp-action="card" asp-route-id="@item.Guid" class="b-item bg_blue">
                                <div class="b-item__content work_org_item">
                                    <img src="/images/building-default.png" alt="" class="cell-middle">
                                    <div class="helper"></div>
                                </div>
                                <div class="b-item__title bottom_title bg_lblue">
                                    <div class="line_four">
                                        @item.Name
                                    </div>
                                </div>
                            </a>
                            </text>
                        }
                    }
                </div>
                @*<a asp-controller="search" asp-route-order="">
                        <span class="small-icon icon-sm-eye inline-block ml9 mt13"><span>Показать все</span></span>
                    </a>*@
            </div>

            <div class="tab-pane" id="vac-sci">
                <h4>Вакансии по областям науки</h4>

                <div class="b-items-category panel-group" id="accordion">
                    <cache expires-after="@TimeSpan.FromMinutes(90)">
                        @Html.Partial("_HomeIndexResearchDirections", Model)
                    </cache>
                </div>
            </div>
        </div>
    </div>


    <div class="row-2">

        <div class="b-search">
            <form asp-controller="search" asp-action="index" method="GET">
                <input class="search-input" type="text" name="search" placeholder="поиск по порталу" value="@ViewBag.Search" />
                <span class="search-button search-button__icon">
                    <input type="submit" value="" class="search-button__submit">
                </span>
            </form>
        </div>

        <h4>Вакансии в графиках</h4>

        <ul class="tabs tabs_after_title">
            <li class="active">
                <span>День</span>
            </li>
            <li>
                <span>Неделя</span>
            </li>
            <li>
                <span>Месяц</span>
            </li>
        </ul>

        <div class="graphics">
            <div class="graphics-item">
                <div class="title-graphic">Число вакансий ( среднее предложение в месяц )</div>

                <div id="chartContainer" style="height: 300px; width: 413px;">
                </div>

            </div>

            <div class="graphics-item">
                <div class="title-graphic">Средняя зарплата и количество вакансий</div>

                <div id="chartContainer2" style="height: 300px; width: 413px;">
                </div>

                @*<div class="image"><img src="/images/index-gr2.jpg"></div>
                <ul class="graph-details">
                    <li class="color3"><span>Средняя заработная плата</span></li>
                    <li class="color1"><span>Количество вакансий</span></li>
                </ul>*@

                <div class="graph-region-select-block">
                    <select name="region" id="region">
                        <option value="1">Выбор региона</option>
                        <option value="2">Выбор региона 1</option>
                        <option value="3">Выбор региона 2</option>
                    </select>
                </div>


                <script type="text/javascript">
                    window.onload = function () {


                        CanvasJS.addColorSet("blueShades4",
                                [//colorSet Array

                                "#041833",
                                "#06365c",
                                "#3a5e90",
                                "#d8e1e9"
                                ]);
                        CanvasJS.addColorSet("blueShades2",
                                [//colorSet Array

                                "#041833",
                                //"#06365c",
                                "#3a5e90"
                                //"#d8e1e9"
                                ]);


                        var chart = new CanvasJS.Chart("chartContainer",
                        {
                            colorSet: "blueShades4",

                            title: {
                                //text: "Число вакансий ( среднее предложение в месяц )"
                            },
                            axisY: {
                                title: "Вакансии"
                            },
                            animationEnabled: true,
                            data: [
                                {
                                    type: "stackedColumn",
                                    toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                                    name: "Руководители групп структурных подразделений",
                                    showInLegend: "true",
                                    dataPoints: [
                                        { y: 38600, label: "Июль" },
                                        { y: 11338, label: "Август" },
                                        { y: 49088, label: "Сентябрь" },
                                        { y: 62200, label: "Октябрь" },
                                        { y: 90085, label: "Ноябрь" }

                                    ]
                                }, {
                                    type: "stackedColumn",
                                    toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                                    name: "Руководители структурных подразделений",
                                    showInLegend: "true",
                                    dataPoints: [
                                        { y: 39900, label: "Июль" },
                                        { y: 135305, label: "Август" },
                                        { y: 107922, label: "Сентябрь" },
                                        { y: 52300, label: "Октябрь" },
                                        { y: 3360, label: "Ноябрь" }

                                    ]
                                }, {
                                    type: "stackedColumn",
                                    toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                                    name: "Сотрудники",
                                    showInLegend: "true",
                                    dataPoints: [
                                        { y: 39900, label: "Июль" },
                                        { y: 135305, label: "Август" },
                                        { y: 107922, label: "Сентябрь" },
                                        { y: 52300, label: "Октябрь" },
                                        { y: 3360, label: "Ноябрь" }

                                    ]
                                }, {
                                    type: "stackedColumn",
                                    toolTipContent: "{label}<br/><span style='\"'color: {color};'\"'><strong>{name}</strong></span>: {y} вакансий",
                                    name: "Прочие",
                                    showInLegend: "true",
                                    dataPoints: [
                                        { y: 39900, label: "Июль" },
                                        { y: 135305, label: "Август" },
                                        { y: 107922, label: "Сентябрь" },
                                        { y: 52300, label: "Октябрь" },
                                        { y: 3360, label: "Ноябрь" }

                                    ]
                                }
                            ]
                            ,
                            legend: {
                                cursor: "pointer",
                                itemclick: function (e) {
                                    if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                                        e.dataSeries.visible = false;
                                    }
                                    else {
                                        e.dataSeries.visible = true;
                                    }
                                    chart.render();
                                }
                            }
                        });


                        var chart2 = new CanvasJS.Chart("chartContainer2",
                        {

                            colorSet: "blueShades2",

                            title: {
                                //text: "Средняя зарплата и количество вакансий"
                            },
                            animationEnabled: true,
                            toolTip: {
                                shared: true,
                                content: function (e) {
                                    var body;
                                    var head;
                                    head = "<span style = 'color:DodgerBlue; '><strong>Месяц: " + (e.entries[0].dataPoint.label) + "</strong></span><br/>";
                                    body = "<span style= 'color:" + e.entries[0].dataSeries.color + "'> " + e.entries[0].dataSeries.name + "</span>: <strong>" + e.entries[0].dataPoint.y + "</strong>  тыс.р.<br/> <span style= 'color:" + e.entries[1].dataSeries.color + "'> " + e.entries[1].dataSeries.name + "</span>: <strong>" + e.entries[1].dataPoint.y + "</strong>  шт";

                                    return (head.concat(body));
                                }
                            },
                            axisY: {
                                title: "Средняя з/п. (тыс.р.)",
                                includeZero: false,
                                suffix: "",
                                lineColor: "#041833"
                            },
                            axisY2: {
                                title: "Количество (шт.)",
                                includeZero: false,
                                suffix: "",
                                lineColor: "#3a5e90"
                            },
                            axisX: {
                                //title: "Месяцы",
                                //suffix: " мес"
                            },
                            data: [
                            {
                                type: "line",
                                name: "Средняя зп",
                                showInLegend: "true",
                                dataPoints: [
                                { x: 6, y: 0, label: "Июнь" },
                                { x: 7, y: 8.2, label: "Июль" },
                                { x: 8, y: 41.7, label: "Август" },
                                { x: 9, y: 16.7, label: "Сентябрь" },
                                { x: 10, y: 31.3, label: "Октябрь" }
                                ]
                            },
                            {
                                type: "line",
                                axisYType: "secondary",
                                name: "Вакансий",
                                showInLegend: "true",
                                dataPoints: [
                                { x: 6, y: 0, label: "Июнь" },
                                { x: 7, y: 90, label: "Июль" },
                                { x: 8, y: 1590, label: "Август" },
                                { x: 9, y: 1740, label: "Сентябрь" },
                                { x: 10, y: 3740, label: "Октябрь" }
                                ]
                            }
                            ]
                            ,
                            legend: {
                                cursor: "pointer",
                                itemclick: function (e) {
                                    if (typeof (e.dataSeries.visible) === "undefined" || e.dataSeries.visible) {
                                        e.dataSeries.visible = false;
                                    }
                                    else {
                                        e.dataSeries.visible = true;
                                    }
                                    chart.render();
                                }
                            }
                        });


                        chart.render();
                        chart2.render();
                    }
                </script>



            </div>
        </div>
    </div>

</div>
